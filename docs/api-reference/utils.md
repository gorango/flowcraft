# API Reference: Utilities

This document covers the standalone utility functions provided by Flowcraft for various tasks like data sanitization, visualization, and creating cancellable delays. All helpers are imported from the main `flowcraft` package.

```typescript
import {
	applyMiddleware,
	generateMermaidGraph,
	sanitizeGraph,
	sleep,
} from 'flowcraft'
```

---

## `sanitizeGraph(rawGraph)`

Sanitizes a raw workflow graph object by removing properties that are not relevant to the execution engine. This is particularly useful for cleaning up graph definitions generated by UI libraries (like React Flow), which often add extra properties for positioning (`x`, `y`) or styling.

### Parameters

-   `rawGraph: { nodes: any[], edges: any[] }`: The raw graph object, potentially containing extraneous properties.

### Returns

-   `WorkflowGraph`: A clean, execution-focused `WorkflowGraph` object that is safe to pass to `GraphBuilder`.

### Example

```typescript
import { sanitizeGraph } from 'flowcraft'

const graphFromUI = {
	nodes: [
		{ id: 'a', type: 'start', data: {}, position: { x: 10, y: 20 }, selected: false },
	],
	edges: [
		{ id: 'e1', source: 'a', target: 'b', type: 'smoothstep' },
	],
}

const cleanGraph = sanitizeGraph(graphFromUI)
// cleanGraph is now:
// {
//   nodes: [{ id: 'a', type: 'start', data: {} }],
//   edges: [{ id: 'e1', source: 'a', target: 'b' }]
// }
```

---

## `generateMermaidGraph(flow)`

Generates a [Mermaid.js](https://mermaid.js.org/) graph definition from a `Flow` instance that was built programmatically (using `.next()`). This is an invaluable tool for debugging and documenting the structure of your workflows.

> [!NOTE]
> For flows built with `GraphBuilder`, it is recommended to use the built-in logging feature by calling `.build(graph, true)` to get a visualization of the final, flattened graph.

### Parameters

-   `flow: Flow`: The `Flow` instance to visualize.

### Returns

-   `string`: The Mermaid syntax for a `graph TD` (top-down) diagram.

### Example

See the **[Visualizing Workflows guide](/guide/tooling/mermaid.md)** for detailed examples.

---

## `sleep(ms, signal?)`

An abortable `sleep` utility that pauses execution for a specified duration. It will reject with an `AbortError` if the provided `AbortSignal` is triggered before the timeout completes.

### Parameters

-   `ms: number`: The number of milliseconds to sleep.
-   `signal?: AbortSignal`: An optional `AbortSignal` to listen for cancellation.

### Returns

-   `Promise<void>`: A promise that resolves after the duration or rejects on abort.

---

## `applyMiddleware(middleware, nodeToRun)`

Composes a chain of middleware functions around a node's execution. This is an advanced utility primarily intended for developers who are building **custom executors**. The default `InMemoryExecutor` uses this internally.

### Parameters

-   `middleware: Middleware[]`: An array of middleware functions to apply.
-   `nodeToRun: AbstractNode`: The node whose `_run` method will be the final step in the chain.

### Returns

-   `MiddlewareNext`: The entry point to the composed middleware chain. Calling this function will start the execution.
